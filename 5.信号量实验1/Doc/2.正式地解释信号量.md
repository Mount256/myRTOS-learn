在μC/OS-III实时操作系统中，**信号量（Semaphore）** 是一种核心的同步机制，主要用于协调多任务间的资源共享和任务同步。其本质是一个计数器，通过“请求”（Pend）和“释放”（Post）操作控制任务的执行流程。以下是信号量的关键特性与应用详解：

---

### ⚙️ **一、信号量的类型**
信号量分为两类，适应不同场景：
1. **二进制信号量（Binary Semaphore）**  
   - **取值**：仅 `0`（资源不可用）或 `1`（资源可用）。  
   - **用途**：保护共享资源的独占访问（如传感器数据写入），确保同一时刻仅一个任务可访问资源。  
   - **示例**：初始化值为 `1`，任务请求后值减为 `0`，释放后恢复为 `1`。

2. **计数型信号量（Counting Semaphore）**  
   - **取值**：非负整数，表示可用资源数量（如缓冲区槽位）。  
   - **用途**：管理多个同类资源（如内存池、连接池）。  
   - **示例**：初始化值为 `N`，每请求一次减 `1`，释放一次加 `1`；值为 `0`时任务需等待。

| **类型**         | **取值范围** | **适用场景**                     | **初始值示例** | **操作规则**               |
|------------------|--------------|----------------------------------|----------------|----------------------------|
| **二进制信号量** | 0或1         | 独占资源访问（如共享外设）       | 1              | 请求后减1，释放后加1        |
| **计数型信号量** | 0~N（N>1）   | 多资源池管理（如缓冲区、连接池） | N（资源数量）  | 请求减1，释放加1，值≥0     |

---

### 🔄 **二、工作机制**
通过API函数操作信号量：  
1. **创建信号量**  
   ```c
   OS_SEM MySem;  // 定义信号量变量
   OSSemCreate(&MySem, "SemName", initial_cnt, &err);  // 初始化
   ```
   - `initial_cnt`：二进制信号量设为 `1`，计数型设为资源数量（如 `10`）。

2. **请求信号量（OSSemPend）**  
   - 若信号量值 `>0`：任务获得信号量，计数器减 `1`，任务继续执行。  
   - 若信号量值 `=0`：任务阻塞（可设置超时），进入等待队列。

3. **释放信号量（OSSemPost）**  
   - 释放后计数器加 `1`。  
   - 若有任务等待，则唤醒**优先级最高**的任务（或所有任务，取决于参数 `opt`）。

---

### ⚠️ **三、应用场景**
1. **任务同步**  
   - 任务A等待任务B完成操作后再执行。  
   - **示例**：任务B发送信号量后，任务A才从 `OSSemPend()` 中退出并执行。

2. **互斥访问共享资源**  
   - 保护共享数据（如全局变量、外设），防止并发冲突。  
   - **示例**：任务访问串口前请求信号量，访问完毕释放。

3. **中断与任务同步（ISR同步）**  
   - 中断服务程序（ISR）通过 `OSSemPost()` 通知任务处理事件（如数据到达）。

---

### ⚠️ **四、注意事项**
1. **优先级反转问题**  
   - 当低优先级任务占用信号量时，高优先级任务需等待，可能被中优先级任务抢占，导致高优先级任务延迟。  
   - **解决方案**：使用**互斥信号量（Mutex）**，临时提升低优先级任务的优先级。

2. **资源管理**  
   - 避免信号量泄漏（未释放）或死锁（互相等待）。  
   - ISR中只能使用 `OSSemPost()`（不可阻塞），且需指定 `OS_OPT_POST_NO_SCHED` 避免触发调度。

---

### 💎 **总结**
信号量是μC/OS-III实现任务协调的核心工具，通过计数器机制灵活支持资源互斥与任务同步。开发中需根据场景选择二进制或计数型信号量，并警惕优先级反转风险。对于高可靠性场景，优先使用互斥信号量（带优先级继承）保护共享资源。