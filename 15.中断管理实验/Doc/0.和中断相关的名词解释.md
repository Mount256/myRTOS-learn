内容来自《[野火]uCOS-III内核实现与应用开发实战指南》。

---

与中断相关的硬件可以划分为三类：外设、中断控制器、CPU本身。

外设：当外设需要请求CPU时，产生一个中断信号，该信号连接至中断控制器。

中断控制器：中断控制器是CPU众多外设中的一个，它一方面接收其他外设中断信号的输入，另一方面，它会发出中断信号给CPU。可以通过对中断控制器编程实现对中断源的优先级、触发方式、打开和关闭源等设置操作。在Cortex-M系列控制器中常用的中断控制器是**NVIC**（内嵌向量中断控制器Nested Vectored Interrupt Controller）。

CPU：CPU会响应中断源的请求，中断当前正在执行的任务，转而执行中断处理程序。NVIC最多支持240个中断，每个中断最多256个优先级。

---

中断号：每个中断请求信号都会有特定的标志，使得计算机能够判断是哪个设备提出的中断请求，这个标志就是中断号。

中断请求：“紧急事件”需向CPU提出申请，要求CPU暂停当前执行的任务，转而处理该“紧急事件”，这一申请过程称为中断请求。

中断优先级：为使系统能够及时响应并处理所有中断，系统根据中断时间的重要性和紧迫程度，将中断源分为若干个级别，称作中断优先级。

中断处理程序：当外设产生中断请求后，CPU暂停当前的任务，转而响应中断申请，即执行中断处理程序。

中断触发：中断源发出并送给CPU控制信号，将中断触发器置“1”，表明该中断源产生了中断，要求CPU去响应该中断，CPU暂停当前任务，执行相应的中断处理程序。

中断触发类型：外部中断申请通过一个物理信号发送到NVIC，可以是电平触发或边沿触发。

中断向量：中断服务程序的入口地址。

中断向量表：存储中断向量的存储区，中断向量与中断号对应，中断向量在中断向量表中按照中断号顺序存储。

临界段：代码的临界段也称为临界区，一旦这部分代码开始执行，则不允许任何中断打断。为确保临界段代码的执行不被中断，在进入临界段之前须关中断，而临界段代码执行完毕后，要立即开中断。

---

中断号、中断向量、中断向量表如何区分？

这是一个非常核心且容易混淆的概念组。它们三者是中断处理机制中不同环节的关键组成部分，环环相扣。

我们可以用一个非常贴切的比喻来理解它们：

> **中断号 = 图书的索书号**  
> **中断向量 = 图书所在的具体架位地址**  
> **中断向量表 = 图书馆的中央索引目录**

下面我们进行详细区分。

---

### 1. 中断号 (Interrupt Number)

*   **是什么？** 一个唯一的**数字编号**，用于区分不同的中断源。
*   **作用？** 就像是一个设备的“身份证号”。当硬件设备（如键盘、鼠标、定时器）想要发出中断请求时，它发出的就是这个编号，告诉CPU：“是**我（编号XX）** 需要服务！”
*   **谁分配的？** 通常由**中断控制器**（如x86架构中的PIC或APIC）硬件来管理和分配。
*   **特点：**
    *   是**硬件的标识**。
    *   是一个**整数**（如IRQ0, IRQ1, ...）。

### 2. 中断向量 (Interrupt Vector)

*   **是什么？** 一个**内存地址**，指向该中断对应的**中断服务程序（ISR）** 的第一条指令。
*   **作用？** 它是中断处理的“目的地”或“目标地址”。CPU一旦获得这个地址，就会跳转到那里去执行代码。
*   **谁提供的？** 由操作系统或 firmware 的开发者**预先设置好**，并存入中断向量表中。
*   **特点：**
    *   是一个**指针**，指向**代码**。
    *   是中断处理的**逻辑入口**。

### 3. 中断向量表 (Interrupt Vector Table)

*   **是什么？** 一块**连续的内存区域**，里面按顺序存放着所有**中断向量**。
*   **作用？** 它是连接**中断号**和**中断向量**的“桥梁”或“查询表”。CPU收到一个中断号后，用它作为**索引**，去这张表里查找对应的中断向量。
*   **工作原理：**
    1.  CPU收到一个中断号 `N`。
    2.  CPU去中断向量表的基地址 + `N` * (每个向量的长度) 的位置查找。
    3.  从那个位置读取出对应的**中断向量（内存地址）**。
    4.  然后CPU跳转到那个地址开始执行ISR。
*   **谁创建的？** 由操作系统在启动初期**初始化**和填充。
*   **特点：**
    *   是一个**数据结构**（通常是一个数组）。
    *   建立了**中断号**到**处理函数地址**的**映射关系**。

---

### 三者的关系与工作流程

整个中断寻址过程可以概括为以下三步：

**中断号 → （查询中断向量表） → 获得中断向量 → （跳转执行）**

1.  **硬件中断发生**，中断控制器向CPU传递一个**中断号**（例如，`0x21`）。
2.  CPU拿着这个**中断号**作为索引，去**中断向量表**中查找第`0x21`个表项。
3.  从这个表项中，CPU读取出**中断向量**（即一个内存地址，例如`0x4010A800`）。
4.  CPU保存当前现场，然后跳转到地址`0x4010A800`处开始执行——这里就是处理该中断的**中断服务程序（ISR）** 的起点。

### 总结与对比表格

| 概念           | 本质               | 角色比喻         | 作用                                     | 相互关系                               |
| :--------------- | :----------------- | :--------------- | :--------------------------------------- | :------------------------------------- |
| **中断号**     | **数字标识符**     | 图书的**索书号** | 唯一标识一个中断源                       | **输入**：用于查找中断向量表的**索引** |
| **中断向量**   | **内存地址**       | 图书的**架位号** | 指向中断处理程序（ISR）的入口地址         | **输出**：从中断向量表中查找到的**值** |
| **中断向量表** | **数据结构（数组）** | 图书馆的**总目录** | 存储所有中断向量，建立中断号到中断向量的映射 | **桥梁**：连接中断号和中断向量的**查询表** |

### 补充说明（不同架构的差异）

*   **x86架构**：早期使用16位实模式，其中断向量表固定在物理内存起始的`0x00000`地址，每个中断向量占4字节（段地址+偏移地址）。
*   **现代架构（如ARM）**：通常使用更为灵活的中断描述符表（IDT），其位置可以由操作系统自由设定，并且每个表项包含的信息更丰富（如权限级别、门类型等），但核心思想——**用中断号索引一个表来获得处理程序的地址**——是完全一致的。