# 软件定时器的相关数据结构

```c
/* 软件定时器控制块 */
typedef  struct  os_tmr              OS_TMR;
struct  os_tmr {
    OS_OBJ_TYPE          Type;
    CPU_CHAR            *NamePtr;                           /* Name to give the timer                                 */
    OS_TMR_CALLBACK_PTR  CallbackPtr;                       /* Function to call when timer expires                    */
    void                *CallbackPtrArg;                    /* Argument to pass to function when timer expires        */
    OS_TMR              *NextPtr;                           /* Double link list pointers                              */
    OS_TMR              *PrevPtr;
    OS_TICK              Match;                             /* Timer expires when OSTmrTickCtr matches this value     */
    OS_TICK              Remain;                            /* Amount of time remaining before timer expires          */
    OS_TICK              Dly;                               /* Delay before start of repeat                           */
    OS_TICK              Period;                            /* Period to repeat timer                                 */
    OS_OPT               Opt;                               /* Options (see OS_OPT_TMR_xxx)                           */
    OS_STATE             State;
};

/* 软件定时器列表 */
typedef  struct  os_tmr_spoke        OS_TMR_SPOKE;
struct  os_tmr_spoke {
    OS_TMR              *FirstPtr;                          /* Pointer to first timer in linked list                  */
    OS_OBJ_QTY           NbrEntries;
    OS_OBJ_QTY           NbrEntriesMax;
};

extern  OS_TMR_SPOKE   OSCfg_TmrWheel[];   // 采用哈希算法的数组

/* 定时器回调函数指针 */
typedef  void                      (*OS_TMR_CALLBACK_PTR)(void *p_tmr, void *p_arg);
```

# 用户可以使用的API（仅列举部分）

```c
void          OSTmrCreate               (OS_TMR                *p_tmr,
                                         CPU_CHAR              *p_name,
                                         OS_TICK                dly,
                                         OS_TICK                period,
                                         OS_OPT                 opt,
                                         OS_TMR_CALLBACK_PTR    p_callback,
                                         void                  *p_callback_arg,
                                         OS_ERR                *p_err);

CPU_BOOLEAN   OSTmrDel                  (OS_TMR                *p_tmr,
                                         OS_ERR                *p_err);

OS_TICK       OSTmrRemainGet            (OS_TMR                *p_tmr,
                                         OS_ERR                *p_err);

CPU_BOOLEAN   OSTmrStart                (OS_TMR                *p_tmr,
                                         OS_ERR                *p_err);

OS_STATE      OSTmrStateGet             (OS_TMR                *p_tmr,
                                         OS_ERR                *p_err);

CPU_BOOLEAN   OSTmrStop                 (OS_TMR                *p_tmr,
                                         OS_OPT                 opt,
                                         void                  *p_callback_arg,
                                         OS_ERR                *p_err);                                          
```

# 系统内部的底层函数（一般带下划线），请用户不要使用

```                                     
/****************** 软件定时器列表管理 ******************/
/* 定时器插入列表中 */
void          OS_TmrLink                (OS_TMR                *p_tmr,
                                         OS_OPT                 opt);
/* 将定时器移除出列表 */                                     
void          OS_TmrUnlink              (OS_TMR                *p_tmr);                                    
                                         
/****************** 软件定时器管理 ******************/   
/* 复位定时器 */
void          OS_TmrClr                 (OS_TMR                *p_tmr);

/* 创建软件定时器任务：在系统初始化时通过OSTaskCreate创建OS_TmrTask */
void          OS_TmrInit                (OS_ERR                *p_err);

/* 软件定时器任务程序：用于管理定时器列表 */
void          OS_TmrTask                (void                  *p_arg);
```